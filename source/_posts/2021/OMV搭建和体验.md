---
title: OMV搭建和体验
date: 2021-08-16 13:23:13
tags: [OMV,NAS]
categories: 
- 菜鸡修炼手册
permalink: /articles/2021/08/16/1629091393130.html
top_img: https://tmx.fishpi.cn/img/cochem-castle-6791148_1920.jpg
cover: https://tmx.fishpi.cn/img/cochem-castle-6791148_1920.jpg
---
![1628345033618.jpg](https://tmx.fishpi.cn/img/cochem-castle-6791148_1920.jpg)

## 旧电脑
就像手机一样，家里总有一些淘汰下来的旧电脑，留着嘛，性能不行，用嘛，又不知道干啥，换不锈钢脸盆？那还不如放着吃灰。
就这样，我手头有4个笔记本，一个surface pro3，除了我自己的笔记本（10年前的acer，我给换了8G内存和固态）和surface还在服役，其他的都在吃灰。
其中包括领导的thinkpad（上古版本）和我姐的东芝（也是上古版本），基本都是2G内存500的机械，吃灰吃灰
还有一个是我妈捡回来的组装山寨笔记本，也就是今天的主角，关于这个笔记本，传奇故事我放在最后，我们先简单看下主要参数
cpu是j1900，内存2G，硬盘250G，有RJ54网线口（重点），有无线网卡

## NAS
NAS是啥不用多说，其实我一直想整一个，白群晖这种是不错，可惜钱包不允许，毕竟小老鼠的奶粉最重要。
而且，这个需求也不是什么刚需，况且手头旧电脑这么多，都可以玩玩。
之前我也考虑过用FreeNAS，Nas4free（已改名XigmaNas），但是这些对硬件要求都不低，基本都要8GRAM，无奈告辞
最终选择OpenmediaVault，要求不高，树莓派也能跑，支持S.M.A.R.T.，Raid，安排上

## 下载
去官网[www.openmediavault.org](https://www.openmediavault.org)下载最新版本
随便找个U盘，制作镜像（我就找了我专门放pe的U盘格式化做的，两个G多点的空间）
制作镜像，我用的[rufus](http://rufus.ie/zh/)，简单好用，不会给你塞乱七八糟的东西进去

## 安装
翻出旧笔记本，插上U盘，开机进BIOS，把U盘设为第一个启动项，然后重启
因为安装都很简单，认字就行，所以没拍照，就大概说一下
启动后，选择安装，选择语言，选中文就行，教程什么的都说选英文，没必要
区域按需选择，我选中国，键盘按需选择，我选汉语，主机名随便填，相当于电脑的名称，我填OMV
域名随便填，我留默认，设置ROOT密码，这里的密码是Debian的root密码，omv的管理员密码后面在说
然后选网卡，系统会自动检测网卡，包括无线网卡，配置网络后继续（但是这里有个坑，后面说）
然后选硬盘，因为默认omv安装的盘是不能做数据盘，所以一般的教程都让你装U盘或整一个小一点盘单独装omv，但是没必要，omv有个插件可以在安装盘上建文件夹，所以大胆往上装
然后选包管理器什么的，默认就行（没必要选网易的）
一路看字自己选择，最后写GRUB，安装完成，拔掉U盘，重启

## 登录
这时候我遇到了一个坑，系统重启完成，输入root密码，登录成功
因为我安装的时候配置网络选的无线网卡，而且也连接成功了的，所以没多想
结果重启后，不知道是不是设备的问题，无线网卡就是打不开，键盘的快捷键也不起作用，命令也不行
进etc/networks改配置，最终就是看网卡的灯闪了一下又灭掉，无奈以失败而告终
幸好，这破电脑有网线接口，救了一命，插上网线，看路由器后台，设备接入成功

## 设置
另外整一台电脑，输入omv那台电脑的ip，打开登录页面
默认管理员账户是 `admin` `openmediavault`
登录后简单查看，改下密码，然后切到更新管理，先更新一波
然后切换到服务，按需打开，一般么，开个FTP，SMB就差不多了
再切换到用户界面，添加账号

## 共享
因为只有一块硬盘，而omv默认是无法在这块硬盘上创建共享文件夹的，所以首先切到插件页面，安装`openmediavault-sharerootfs`插件。
安装完成，切换到共享文件夹，添加，输入名字，选择设备，其他默认就行，权限按需自己给，创建完成。
然后切换到对应的服务，切换到共享，把对应的文件夹添加上，应用，完事
这时候，在网络里应该就能看到omv这个主机，没有的话（我的就没看到，不知道为啥），就在资源管理器输地址`\\{ip}`，例如`\\192.168.1.2`，输入用户名密码就行
安卓手机，我用的荣耀，是鸿蒙，打开文件管理，选择网络邻居，应该就能看到了
iphone，打开文件，添加服务器，输入ip，然后连接
当然，智能电视也是可以的，所以，你懂的
当然，因为开了ftp服务，所以任意找ftp软件也是可以的

## 手机管理
Google Play上有一个管理软件，[OMV Remote](https://play.google.com/store/apps/details?id=com.dev.doods.omvremote2)
不知道为啥我的账号下载不了，所以用第三方服务下载apk然后安装
启动点右下角fab看个广告会自动扫描，点击扫描出的ip，然后就崩溃了……
所以看完广告后不用管他，点右下角fab自己添加ip就好了
基本上网页管理后台的内容都有了

## 进阶设置
只针对SMB
如果我不想别人看到某个文件夹，是不是只要不给权限就行了呢？
答案是不是的。
没有权限确实看不到内容，但是这个文件夹还是看得到的，只是访问的时候无法访问
那要怎么办呢？？
切换到SMB，在高级选项的扩展选项中，填入`access based share enum = yes` 就ok了

## 最后
虽然这时候已经实现了内网访问，但是我们的目标是实现随时随地都能访问，也就是外网访问
这就不得不扯到公网IP的问题了，如果有固定的公网IP，那是再好不过，可惜我家里用的是辣鸡华数，么的
没用固定的公网IP，备用方案是DDNS，而且我用的小米AX3600集成了DDNS，可以用花生壳这些，但是，你得有公网IP（不一定固定），可惜，华数还是么的
最终方案就是用frp了，但是，这个需要一个有公网IP的vps，可惜，我的良心云已经到期了，所以我也就止步于此了，不继续折腾了
把显示器亮度调到最低（我试着关掉显示器，但是没有成功），改天整个功率计，测下功耗（当然，怎么算都是不划算的），就这样丢在路由器旁边吧

## 传奇故事
这个笔记本，是我妈当年还在打扫卫生的时候捡来的，有人拿着这电脑到垃圾桶扔掉，我妈看着还行，就拿回来了
刚到我手上的时候，这电脑开不了机，进到xp的loading那里就死掉了
看外观，银色，是lenovo，C面，贴着蓝色的intel i7和绿色的GTX，哦豁，牛皮啊，i7+独显，就是这个触摸板，体验极其垃圾，按键触感贼差
翻出系统盘，win10安排上，重装完成，来来来，看下配置
j1900，这是个啥，噢，是赛扬，说好的i7呢？
再看下显卡……独显呢？哦，不存在的
看下内存，噢，两个G
emmm，难怪丢掉那个人说很卡，确实，这电脑不丢掉留着干啥，搭NAS吗？？
再看下那个人一起丢掉的发票，7000+，emmm……
只能说，那个js真不怕被打么……






